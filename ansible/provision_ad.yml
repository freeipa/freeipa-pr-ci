---
# Update Administrator's password
- hosts: ad-root:ad-tree:ad-child
  gather_facts: False
  tasks:
    - name: set administrator password
      win_user:
        name: Administrator
        password: Secret123
      vars:
        ansible_password: vagrant

- hosts: ad-root:ad-tree:ad-child
  roles:
    # - win-ping
    - windows/common

- hosts: ad-root
  roles:
    - windows/ad-root

- hosts: ad-child
  roles:
    - windows/ad-child

- hosts: ad-tree
  roles:
    - windows/ad-tree

- hosts: ad-root
  roles:
  - windows/ipa-ad-root

- hosts: ad-child
  roles:
  - windows/ipa-ad-domain

# Provision linux hosts but include ad and ad-child in the list so we can access
# their data to generate ipa test config file
- hosts: all
  gather_facts: yes
  roles:
    - role: machine/provision
      when: not inventory_hostname.startswith('ad')
